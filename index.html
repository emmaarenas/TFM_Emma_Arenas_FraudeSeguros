<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pipeline Diagram</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .mermaid {
      text-align: center;
    }
  </style>
  <!-- Carga Mermaid desde un CDN -->
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true });
  </script>
</head>
<body>
  <h1>Pipeline Diagram</h1>
  <div class="mermaid">
flowchart TD
    %% Data Layer
    subgraph "Data Layer"
        direction TB
        RawData["Raw Data\nData/data_raw.csv"]:::data
        ProcessedData["Processed Data\nData/data_processed.csv"]:::data
    end

    %% Notebook Pipeline
    subgraph "Notebook Pipeline"
        direction TB
        EDA["EDA Notebook\nNotebooks/EDA.ipynb"]:::compute
        Preprocessing["Preprocessing Notebook\nNotebooks/Preprocesado.ipynb"]:::compute
        Modeling["Modeling Notebook\nNotebooks/Modelado.ipynb"]:::compute
    end

    %% Artifact Store
    subgraph "Artifact Store"
        direction TB
        EnsembleConfig["ensemble_config.json"]:::storage
        FeatureCols["feature_cols.pkl"]:::storage
        IOSchema["io_schema.json"]:::storage
        LRModel["model_logreg.pkl"]:::storage
        RFModel["model_rf.pkl"]:::storage
        XGBModel["model_xgb.pkl"]:::storage
        LGBMModel["model_lgbm.pkl"]:::storage
        Explainer["explainer.pkl"]:::storage
    end

    %% Backend Service
    subgraph "Backend Service"
        direction TB
        API["api_backend.py"]:::service
        HistLog["historial.json"]:::service
    end

    %% Frontend UI
    subgraph "Frontend UI"
        direction TB
        StreamlitApp["app.py"]:::service
        Config["config.toml"]:::service
        Assets["Assets/"]:::service
    end

    %% External Libraries & Environment
    subgraph "External Libraries & Env"
        direction TB
        ReqTxt["requirements.txt"]:::external
    end

    %% Connections
    RawData -->|"analysis"| EDA
    RawData -->|"preprocess"| Preprocessing
    Preprocessing -->|"produce"| ProcessedData
    ProcessedData -->|"train"| Modeling
    EDA -->|"insights"| Modeling
    Modeling -->|"export artifacts"| EnsembleConfig
    Modeling --> FeatureCols
    Modeling --> IOSchema
    Modeling --> LRModel
    Modeling --> RFModel
    Modeling --> XGBModel
    Modeling --> LGBMModel
    Modeling --> Explainer

    EnsembleConfig -->|"load"| API
    FeatureCols --> API
    IOSchema --> API
    LRModel --> API
    RFModel --> API
    XGBModel --> API
    LGBMModel --> API
    Explainer --> API

    StreamlitApp <-->|"in-process calls"| API
    API -->|"log"| HistLog
    StreamlitApp --> Config
    StreamlitApp --> Assets

    ReqTxt

    %% Click Events
    click RawData "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Data/data_raw.csv"
    click ProcessedData "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Data/data_processed.csv"
    click EDA "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Notebooks/EDA.ipynb"
    click Preprocessing "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Notebooks/Preprocesado.ipynb"
    click Modeling "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Notebooks/Modelado.ipynb"
    click EnsembleConfig "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/ensemble_config.json"
    click FeatureCols "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/feature_cols.pkl"
    click IOSchema "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/io_schema.json"
    click LRModel "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/model_logreg.pkl"
    click RFModel "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/model_rf.pkl"
    click XGBModel "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/model_xgb.pkl"
    click LGBMModel "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/model_lgbm.pkl"
    click Explainer "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Artifacts/explainer.pkl"
    click API "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Service/api_backend.py"
    click HistLog "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Service/historial.json"
    click StreamlitApp "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Service/app.py"
    click Config "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/Service/.streamlit/config.toml"
    click Assets "https://github.com/emmaarenas/tfm_fraudeseguros/tree/master/Assets/"
    click ReqTxt "https://github.com/emmaarenas/tfm_fraudeseguros/blob/master/requirements.txt"

    %% Styles
    classDef data fill:#E3F2FD,stroke:#2196F3,stroke-width:2px
    classDef compute fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef storage fill:#FFF9C4,stroke:#FBC02D,stroke-width:2px
    classDef service fill:#FFE0B2,stroke:#F57C00,stroke-width:2px
    classDef external fill:#E1BEE7,stroke:#8E24AA,stroke-width:2px
  </div>
</body>
</html>

